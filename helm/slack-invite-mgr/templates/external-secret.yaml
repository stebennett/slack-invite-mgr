{{- if .Values.externalSecrets.enabled }}
# Google Credentials Secret
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "slack-invite-mgr.googleCredentialsSecretName" . }}
  labels:
    {{- include "slack-invite-mgr.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval }}
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreName }}
    kind: {{ .Values.externalSecrets.secretStoreKind }}
  target:
    name: {{ include "slack-invite-mgr.googleCredentialsSecretName" . }}
    creationPolicy: Owner
  data:
    - secretKey: credentials.json
      remoteRef:
        key: {{ .Values.externalSecrets.googleCredentials.remoteRef }}
        {{- if .Values.externalSecrets.googleCredentials.property }}
        property: {{ .Values.externalSecrets.googleCredentials.property }}
        {{- end }}
---
# Application Secrets (Spreadsheet ID, Sheet Name)
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "slack-invite-mgr.appSecretsName" . }}
  labels:
    {{- include "slack-invite-mgr.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval }}
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreName }}
    kind: {{ .Values.externalSecrets.secretStoreKind }}
  target:
    name: {{ include "slack-invite-mgr.appSecretsName" . }}
    creationPolicy: Owner
  data:
    {{- range $key, $envVar := .Values.externalSecrets.appSecrets.keys }}
    - secretKey: {{ $envVar }}
      remoteRef:
        key: {{ $.Values.externalSecrets.appSecrets.remoteRef }}
        property: {{ $key }}
    {{- end }}
---
{{- if .Values.sheets.enabled }}
# SMTP Secrets (Email configuration)
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "slack-invite-mgr.smtpSecretsName" . }}
  labels:
    {{- include "slack-invite-mgr.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval }}
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreName }}
    kind: {{ .Values.externalSecrets.secretStoreKind }}
  target:
    name: {{ include "slack-invite-mgr.smtpSecretsName" . }}
    creationPolicy: Owner
  data:
    {{- range $key, $envVar := .Values.externalSecrets.smtpSecrets.keys }}
    - secretKey: {{ $envVar }}
      remoteRef:
        key: {{ $.Values.externalSecrets.smtpSecrets.remoteRef }}
        property: {{ $key }}
    {{- end }}
{{- end }}
{{- end }}
